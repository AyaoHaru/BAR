<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Guess the Drink</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      padding: 20px;
    }
    .ingredients {
      margin-bottom: 20px;
    }
    .ingredients div {
      display: inline-block;
      margin: 5px;
      padding: 10px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .game {
      margin-top: 20px;
    }
    .guess-input {
      display: flex;
      margin-bottom: 10px;
    }
    .guess-input input {
      width: 20px;
      margin-right: 5px;
      text-align: center;
      font-size: 16px;
    }
    .message {
      margin: 10px 0;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h1>三杯和万事 一醉解千愁</h1>
<p style="color: gray; font-size: 14px; margin-top: -10px;">
  输入 8 个代表材料的数字（0–9），猜出正确顺序的鸡尾酒配方。你有12次机会！
  材料正确=材料正确但顺序错误的个数。
  <br></br>
  有些材料不像鸡尾酒里会加的？我知道……我知道。
</p>
<div class="ingredients" id="ingredients-list"></div>

<div class="game">
  <div class="guess-input" id="guess-input"></div>
  <button id = "submit-btn" onclick="submitGuess()">猜一猜</button>
  <div class="message" id="message"></div>
  <ul id="history"></ul>
</div>

<script>
  const ingredientPool = [
      '柠檬', '薄荷叶', '伏特加', '朗姆酒', '龙舌兰', '可乐',
      '奎宁水', '橙汁', '辣椒粉', '盐',
      '糖浆', '红石榴糖浆', '冰块', '椰奶',
      '浓缩咖啡', '姜汁汽水', '肉桂', '蜂蜜', '青柠汁',
      '感冒药','酱油','醋','芥末酱','耗油','番茄酱','辣油'
  ];

  const colors = ['red', 'blue', 'green', 'purple', 'orange'];

  const digitToIngredient = {};
  const digitColors = {};
  const usedIngredients = [];

  function getRandomIngredient() {
    let ingredient;
    do {
      ingredient = ingredientPool[Math.floor(Math.random() * ingredientPool.length)];
    } while (usedIngredients.includes(ingredient));
    usedIngredients.push(ingredient);
    return ingredient;
  }

  for (let i = 0; i <= 9; i++) {
    digitToIngredient[i] = getRandomIngredient();
  }

  const colorPairs = {};
  for (let i = 0; i < 10; i += 2) {
    const color = colors[Math.floor(i / 2)];
    digitColors[i] = color;
    digitColors[i + 1] = color;
    colorPairs[color] = [i, i + 1];
  }

  const correctSequence = Array.from({length: 8}, () => Math.floor(Math.random() * 10));
  let attempts = 0;
  const maxAttempts = 12;
  let hintStage = 0;

const colorToChinese = {
  red: '红瓶',
  blue: '蓝瓶',
  green: '绿瓶',
  purple: '紫瓶',
  orange: '橙瓶'
};


  const ingredientList = document.getElementById('ingredients-list');
  for (let i = 0; i <= 9; i++) {
    const div = document.createElement('div');
    div.innerHTML = `<strong>${i}</strong>: ${digitToIngredient[i]} <span style="color:${digitColors[i]}">(${colorToChinese[digitColors[i]]})</span>`;
    ingredientList.appendChild(div);
  }

  const guessInput = document.getElementById('guess-input');
  for (let i = 0; i < 8; i++) {
    const input = document.createElement('input');
    input.maxLength = 1;
    input.type = 'tel';
    input.inputMode = 'numeric';  
    input.pattern = '[0-9]*';
    guessInput.appendChild(input);
  }

  function submitGuess() {
    const inputs = [...guessInput.querySelectorAll('input')];
    const guess = inputs.map(input => parseInt(input.value));
    if (guess.some(isNaN) || guess.length !== 8) {
      document.getElementById('message').textContent = "请输入8种调酒材料 (0-9)";
      return;
    }

    attempts++;
    let correctPlace = 0;
    let correctNumber = 0;

    const seqCopy = [...correctSequence];
    const guessCopy = [...guess];

    // First pass for correct place
    for (let i = 0; i < 8; i++) {
      if (guess[i] === correctSequence[i]) {
        correctPlace++;
        seqCopy[i] = guessCopy[i] = null;
      }
    }

    // Second pass for correct numbers in wrong place
    for (let i = 0; i < 8; i++) {
      if (guessCopy[i] !== null) {
        const index = seqCopy.indexOf(guessCopy[i]);
        if (index !== -1) {
          correctNumber++;
          seqCopy[index] = null;
        }
      }
    }

    const history = document.getElementById('history');
    const li = document.createElement('li');
    li.textContent = `猜测 ${attempts}: ${guess.join('')} → ${correctPlace} 处顺序正确, ${correctNumber} 种材料正确`;
    history.insertBefore(li,history.firstChild);

    const submitBtn = document.getElementById('submit-btn');

    if (correctPlace === 8) {
      const drinkName = correctSequence.map(num => digitToIngredient[num]).join(' 加 ');
      const numberString = correctSequence.join(' ');
      const ingredientCount = {};
      correctSequence.forEach(num => {
        const ingredient = digitToIngredient[num];
        ingredientCount[ingredient] = (ingredientCount[ingredient] || 0) + 1;
      });
      const countStrings = Object.entries(ingredientCount).map(([ingredient, count]) => {
        return `${count}份${ingredient}`;
      }).join('，');

      document.getElementById('message').innerHTML = `🎉 恭喜！这是一杯特调 <strong>${drinkName}</strong>. <br>
      <em>(对应数字: ${numberString})</em><br>
      这里面有 ${countStrings}。请享用!`;
      guessInput.innerHTML = '';
      submitBtn.textContent = '再猜一杯';
      submitBtn.onclick = resetGame;
      return;
    }

    if (attempts % 3 === 0 && hintStage < 3) {
      giveHint(hintStage++,history);
    }

    if (attempts >= maxAttempts) {
      const drinkName = correctSequence.map(num => digitToIngredient[num]).join(' 加 ');
      const numberString = correctSequence.join(' ');
      
      const ingredientCount = {};
      correctSequence.forEach(num => {
        const ingredient = digitToIngredient[num];
        ingredientCount[ingredient] = (ingredientCount[ingredient] || 0) + 1;
      });
      const countStrings = Object.entries(ingredientCount).map(([ingredient, count]) => {
        return `${count}份${ingredient}`;
      }).join('，');

      document.getElementById('message').innerHTML = `❌ 猜错啦! 这是一杯 <strong>${drinkName}</strong>.<br>
      <em>(对应数字: ${numberString})</em><br>
      这里面有 ${countStrings}。你想试试吗？`;
      guessInput.innerHTML = '';
      submitBtn.textContent = '再猜一杯（清空记录）';
      submitBtn.onclick = resetGame;
    }
  }

  function giveHint(stage,history) {
    let hint = '';
    const idx = Math.floor(Math.random() * 2);
    if (stage === 0) {
      const color = digitColors[correctSequence[idx]];
      hint = `提示1：如果这会给你一些灵感——我在第${idx + 1}步加了一种 ${colorToChinese[color]} 的材料。`;
    } else if (stage === 1) {
      const ingredient = digitToIngredient[correctSequence[idx+2]];
      hint = `提示2：更具体点说——我在第${idx + 3}步加了一些${ingredient}!`;
    } else if (stage === 2) {
      const ingredient = digitToIngredient[correctSequence[idx+4]];
      hint = `提示3：这是独家秘方：我在第${idx + 5}步加了一些${ingredient}……`;
    } else if (stage === 3) {
      const ingredient = digitToIngredient[correctSequence[idx+6]];
      hint = `提示4：另外，我在第${idx + 7}步加了一些${ingredient}，只是为了好玩……好啦，这是最后的提示，再说下去就要破坏游戏的乐趣了。`;
    }
    const li = document.createElement('li');
    li.textContent = hint;
    li.style.fontStyle = 'italic';
    document.getElementById('history').insertBefore(li,history.firstChild);
  }

  function resetGame() {
    location.reload();
  }

</script>

</body>
</html>

<script src="smart-input.js"></script>









